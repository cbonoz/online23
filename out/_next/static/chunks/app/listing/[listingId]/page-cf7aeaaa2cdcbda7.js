(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{27416:function(e,t,r){Promise.resolve().then(r.bind(r,19784))},67245:function(e,t,r){"use strict";r.r(t),r.d(t,{WalletContext:function(){return i},WalletProviderWrapper:function(){return c},useWallet:function(){return o}});var n=r(57437),a=r(2265),s=r(93697);let i=(0,a.createContext)({}),c=e=>{let{children:t}=e,[r,c]=(0,a.useState)(null),[o,l]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),h=async()=>{let e=new s.ig,t=await e.connectWallet({wallet:s.Ag.METAMASK});c(t),l(e),u(await e.getProvider())},f=async()=>{try{await o.disconnectWallet()}catch(e){console.error("error logging out",e)}c(null)};return(0,n.jsx)(i.Provider,{value:{wallet:r,connect:h,logout:f,provider:d,dataverseConnector:o,test:5},children:t})},o=()=>(0,a.useContext)(i)},19784:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _}});var n=r(57437),a=r(2265),s=r(28170),i=r(88110),c=r.n(i),o=r(84602),l=r(20020),d=r(18142),u=r(49385),h=r(40155),f=r(33071),g=r(43574),x=r(44438),p=r(95708),j=r(16691),y=r.n(j),m=r(61927),w=r(86260),b=r(77417),v=r(46912),k=r(80603),Z=r(66978),S=r(23199),D=r(67245),C=r(73760);r(21239);var N=e=>{let{listingId:t}=e,[r,i]=(0,a.useState)(!0),[j,N]=(0,a.useState)(w.i3),[_,P]=(0,a.useState)(!1),[E,L]=(0,a.useState)(),[W,M]=(0,a.useState)(),[O,B]=(0,a.useState)(),[A,I]=(0,a.useState)();console.log("listing",t);let{connect:T,provider:F,wallet:R,logout:G}=(0,D.useWallet)();async function U(e){M(),i(!0);try{let t=await (0,S.LR)(e);if((0,m.xb)(t))throw Error("Listing not found. Do you have a valid listing url?");let r=t[0];console.log("got listing",r),B(r)}catch(e){console.error("error getting listing",e),M(e.message)}finally{i(!1)}}async function Y(e){try{let r=await (0,Z.sd)(e,t);console.log("metadata",r),L({cid:r[0],totalPurchases:r[3]})}catch(e){console.log("error getting metadata",e)}}(0,a.useEffect)(()=>{U(t)},[t]),(0,a.useEffect)(()=>{F&&Y(F.signer)},[F,t]),(0,a.useEffect)(()=>{async function e(e){i(!0);try{let t=await (0,S.eq)(e);console.log("offers",t),N(t)}catch(e){console.error("error getting offers",e)}finally{i(!1)}}t&&e(t)},[t]);let $=[{title:"Listings",href:"/search"},{title:null==O?void 0:O.name,href:"/listing/".concat(t)}];async function J(){i(!0);try{let e=await (0,Z.w1)(F.signer,O.address,O.price.toString());console.log("purchase",e),L(e);try{(0,S.I0)(F.signer,O.address)}catch(e){}}catch(e){console.error("error purchasing",e),alert("Error purchasing: "+(0,m.dX)(e))}finally{i(!1)}}async function K(){if(L(),!A||A<=0){alert("Please enter an offer more than "+(0,m.xG)(0));return}if(A>=parseFloat(X.price.split(" ")[0])){alert("Please enter an offer less than the listing price: "+X.price);return}i(!0);try{let e={amount:C.fi(A.toString()),listingId:O.id,createdAt:Date.now(),createdBy:R.address,address:O.address},t=await (0,S.Cm)(F.signer,e);console.log("make offer",t),L()}catch(e){console.error("error making offer",e)}finally{N([...j,[new Date().toLocaleDateString(),A]]),i(!1)}}if(r)return(0,n.jsx)(u.Z,{size:"large"});if(W||!O)return(0,n.jsx)(p.ZP,{status:"warning",title:"Error loading listing",subTitle:W||"Please try another url or return to search",extra:[(0,n.jsx)(c(),{type:"primary",onClick:()=>window.location.href="/",children:"Return to search"},"search")]});let X=(0,m.JI)(O),q=!(0,m.xb)(null==E?void 0:E.cid);return(0,n.jsxs)("div",{className:"listing-detail-page",children:[(0,n.jsx)(x.Z,{items:$}),(0,n.jsx)("br",{}),(0,n.jsxs)(s.Z,{title:(0,n.jsx)("span",{style:{color:"green"},children:"For Purchase"}),children:[(0,n.jsx)("h1",{children:O.name}),(0,n.jsx)("h3",{children:O.description}),(0,n.jsx)(h.Z,{}),(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)(d.Z,{span:16,children:[(0,n.jsxs)("section",{className:"product-images",children:[(0,n.jsx)(y(),{width:450,height:300,src:O.image,alt:O.name}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{})]}),(0,n.jsx)("section",{className:"product-details",children:(0,n.jsxs)(s.Z,{title:"Details",children:[Object.keys(X).map((e,t)=>{if(!("image"===e||"description"===e||"name"===e||(0,m.xb)(e)))return(0,n.jsx)("span",{children:(0,n.jsx)(o.Z,{style:{display:"inline-block",marginRight:32},title:(0,m.iN)(e),value:X[e]})},t)}),!!O.verified&&(0,n.jsx)("p",{className:"success-text",children:(0,n.jsxs)("h3",{children:[(0,n.jsx)(v.Z,{}),"\xa0Listing marked verified by ",w.iC]})}),!O.verified&&(0,n.jsxs)("p",{className:"error-text",children:[(0,n.jsx)(k.Z,{}),"\xa0Listing not yet verified, purchase at your own risk."]})]})})]}),(0,n.jsx)(d.Z,{span:8,children:(0,n.jsx)(s.Z,{title:"Purchase",children:(0,n.jsxs)("section",{className:"product-actions",children:[(0,n.jsxs)("p",{children:[(0,n.jsxs)("b",{children:["Listing Price: ",X.price," "]}),(0,n.jsx)("br",{})]}),(0,n.jsx)("p",{children:"Purchase this dataset or make an offer."}),(0,n.jsx)("br",{}),(0,n.jsx)(c(),{loading:r,disabled:!R||r||q,onClick:J,type:"primary",children:R?"Buy Now":"Connect Wallet"}),"\xa0",(null==R?void 0:R.address)&&(0,n.jsx)(c(),{disabled:r||q,onClick:async()=>{P(!_)},type:"link",children:"Make an Offer"}),q&&(0,n.jsxs)("div",{children:[(0,n.jsx)(h.Z,{}),(0,n.jsx)("p",{className:"success-text",children:"You have purchased this dataset!"}),(0,n.jsx)("b",{children:(0,n.jsx)("a",{href:(0,m.W)(E.cid),target:"_blank",children:"Download again"})}),(0,n.jsx)("br",{}),(0,n.jsx)("a",{href:"https://github.com/filecoin-project/lassie#extracting-content-from-a-car",target:"_blank",children:"How to extract"})]})]})})})]}),(0,n.jsx)(h.Z,{}),(0,n.jsx)(l.Z,{children:(0,n.jsxs)(d.Z,{span:24,children:[(0,n.jsx)("h3",{children:"Offer trend"}),(0,n.jsx)(b.wW,{data:j,xtitle:"Date",ytitle:"Amount (".concat(w.hs.symbol),download:!0}),(0,n.jsx)("a",{href:"#",onClick:()=>{N(w.i3)},children:"Show example offers"})]})})]}),(0,n.jsxs)(f.Z,{title:null==O?void 0:O.name,open:_,okText:"Make offer",onOk:K,confirmLoading:r,onCancel:()=>P(!1),children:[(0,n.jsx)("h3",{children:"Make an offer on this dataset"}),(0,n.jsxs)("p",{children:["Listing price: ",X.price]}),(0,n.jsx)(h.Z,{}),(0,n.jsx)(g.Z,{type:"number",placeholder:"Enter amount (".concat(w.hs.symbol,")"),prefix:"Your offer (".concat(w.hs.symbol,"):"),value:A,onError:e=>console.log("error",e),onChange:e=>I(e.target.value)})]})]})};function _(e){let{params:t}=e,{listingId:r}=t;return(0,n.jsx)("div",{children:(0,n.jsx)(N,{listingId:r})})}},61927:function(e,t,r){"use strict";r.d(t,{$A:function(){return s},JI:function(){return p},RD:function(){return x},W:function(){return l},dX:function(){return g},g$:function(){return c},iN:function(){return u},jY:function(){return h},sN:function(){return d},xG:function(){return o},xb:function(){return f}});var n=r(86260),a=r(73760);let s=e=>e?"".concat(e.substr(0,6),"**"):"",i=e=>(e instanceof Date||(e=e?new Date(e):new Date),"".concat(e.toLocaleDateString()," ").concat(e.toLocaleTimeString())),c=e=>n.O0===e,o=(e,t)=>0===e?"Free":e?"".concat(e," ").concat(t||n.hs.symbol):"",l=(e,t)=>{let r="".concat(n._W,"/").concat(e);return t?"".concat(r,"/").concat(t):r},d=e=>"".concat(window.location.origin,"/listing/").concat(e),u=e=>13===e.length?new Date(e).toLocaleDateString():e.replace(/([A-Z])/g," $1").replace(/^./,function(e){return e.toUpperCase()}).replace(/_/g," "),h=(e,t)=>"".concat(n.hs.explorerUrl).concat(t?"tx/":"address/").concat(e).concat(31415===n.hs.id?"?network=wallaby":""),f=e=>!e||0===e.length,g=e=>(-1!==e.indexOf("404")?e="Dataset not found. Do you have the correct url? Otherwise, try creating a new dataset.":-1!==e.indexOf("network changed")&&(e="Network changed since page loaded, please refresh."),e);function x(e){if(0==e)return"0 Byte";var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}let p=e=>e?{...e,created_by:s(e.created_by),created_at:i(e.created_at),price:o(a.dF(e.price+""),n.hs.symbol),verified:e.verified?"Verified":"Unverified"}:{}}},function(e){e.O(0,[941,674,26,691,409,44,891,110,697,664,170,574,813,132,611,736,773,198,22,971,596,744],function(){return e(e.s=27416)}),_N_E=e.O()}]);